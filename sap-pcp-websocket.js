!function(y){"use strict";function g(e){if(this._oUri={},e){var o=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/.exec(e);this._oUri.path=o[0],this._oUri.protocol=o[4],this._oUri.host=o[6]}else this._oUri.path=y.location.pathname,this._oUri.protocol=y.location.protocol,this._oUri.host=y.location.host;this.host=function(e){if(!e)return this._oUri.host;this._oUri.host=e},this.protocol=function(e){if(e)this._oUri.protocol=e;else if(this._oUri.protocol)return this._oUri.protocol.replace(":","")},this.path=function(e){if(!e)return this._oUri.path;this._oUri.path=e}}function m(e,o){var r={},s={};function n(e){r&&r.log&&r.log(e)}if(r=y.console,y.WebSocket)if(e&&"string"==typeof e&&""!==e){var t=new g(e),c=new g;if(c.protocol("https"===c.protocol()?"wss":"ws"),!t.protocol()||t.protocol()===c.protocol())return t.host()||(t.host(c.host()),e=c.protocol()+"://"+t.host()+t.path()),s=!o||"string"!=typeof o&&"[object Array]"!==Object.prototype.toString.call(o)?new WebSocket(e):new WebSocket(e,o),this.readyState=s.readyState,s.onopen=function(e){var o=!1;if(this.readyState=s.readyState,""===s.protocol)o=!0;else for(var t in SapPcpWebSocket.SUPPORTED_PROTOCOLS)if(SapPcpWebSocket.SUPPORTED_PROTOCOLS.hasOwnProperty(t)&&SapPcpWebSocket.SUPPORTED_PROTOCOLS[t]===s.protocol){o=!0;break}if(!o)return n("Unsupported protocol '"+s.protocol+"' selected by the server. Connection will be closed."),void this.close(1e3,"Unsupported protocol '"+s.protocol+"' selected by the server");this.protocol=s.protocol,this._sendPing(this,!0),this.onopen&&"function"==typeof this.onopen&&this.onopen(e)}.bind(this),s.onclose=function(e){this.readyState=s.readyState,this.onclose&&"function"==typeof this.onclose&&this.onclose(e)}.bind(this),s.onmessage=function(e){var o=-1,t={};if(this.readyState=s.readyState,"string"==typeof e.data&&(o=e.data.indexOf(this._SEPARATOR)),-1!==o?((t=this._copyMessageEvent(e)).pcpFields=this._extractPcpFields(e.data.substring(0,o)),t.data=e.data.substr(o+this._SEPARATOR.length)):(t=e,r.log("Invalid PCP message received: "+e.data)),this._sendPing(this,!0),this.protocol===SapPcpWebSocket.SUPPORTED_PROTOCOLS.v11&&t.pcpFields["pcp-ext-command"])switch(t.pcpFields["pcp-ext-command"]){case"pong":this.bPong=!0;break;case"ping":this.send("",{"pcp-ext-command":"pong"});break;default:this.onmessage&&"function"==typeof this.onmessage&&this.onmessage(t)}else this.onmessage&&"function"==typeof this.onmessage&&this.onmessage(t)}.bind(this),s.onerror=function(e){this.readyState=s.readyState,this.onerror&&"function"==typeof this.onerror&&this.onerror(e)}.bind(this),this.send=function(e,o){var t=typeof e,n="";s&&s.readyState===WebSocket.OPEN?(n=this._serializePcpFields(o,t,this._MESSAGE),s.send(n+e),"ping"!==o["pcp-ext-command"]&&this._sendPing(this,!0)):s?s.readyState!==WebSocket.OPEN&&r.log("WebSocket has not readyState open, readyState is: "+s.readyState):r.log("WebSocket not initialized")},this.close=function(e,o){s&&s.readyState===WebSocket.OPEN&&(e&&o?(123<o.length&&(o=o.substring(0,122)),s.close(e,o)):s.close())},this;n("Protocol ( "+t.protocol()+" ) is not supported. Leaving...")}else n("No URL to connect to WebSocket. Leaving...");else n("Browser does not support WebSockets. Leaving...")}m.prototype.onopen=null,m.prototype.onclose=null,m.prototype.onmessage=null,m.prototype.onerror=null,Object.defineProperty(m.prototype,"_deserializeRegexp",{value:new RegExp(/((?:[^:\\]|(?:\\.))+):((?:[^:\\\n]|(?:\\.))*)/)}),Object.defineProperty(m.prototype,"_SEPARATOR",{value:"\n\n"}),Object.defineProperty(m.prototype,"_MESSAGE",{value:"MESSAGE"}),m.prototype._extractPcpFields=function(e){for(var o=e.split("\n"),t=o.length,n=[],r={};t--;)3===(n=o[t].match(this._deserializeRegexp)).length&&(r[this._unescape(n[1])]=this._unescape(n[2]));return r},m.prototype._unescape=function(e){for(var o=e.split("\b"),t=o.length;t--;)o[t]=o[t].replace(/\\\\/g,"\b").replace(/\\:/g,":").replace(/\\n/g,"\n").replace(/\u0008/g,"\\");return o.join("\b")},m.prototype._serializePcpFields=function(e,o,t){var n="",r="",s="";if("string"===o?s="text":"blob"!==o&&"arraybuffer"!==o||(s="binary"),e&&"object"==typeof e)for(r in e)e.hasOwnProperty(r)&&(n+=this._escape(r)+":"+this._escape(e[r])+"\n");return"pcp-action:"+t+"\npcp-body-type:"+s+"\n"+n+"\n"},m.prototype._escape=function(e){return e.replace(/\\/g,"\\\\").replace(/:/g,"\\:").replace(/\n/g,"\\n")},m.prototype._copyMessageEvent=function(e){var o={},t="";if(null===e||"object"!=typeof e)return o;for(t in e)e.hasOwnProperty(t)&&"data"!==t&&(o[t]=e[t]);return o},m.prototype._sendPing=function(e,o){e.readyState===SapPcpWebSocket.OPEN&&e.protocol===SapPcpWebSocket.SUPPORTED_PROTOCOLS.v11&&(e.oPing&&o?clearTimeout(e.oPing):o?e.oPing||(e.bPong=!0):(e.bPong=!1,e.send("",{"pcp-ext-command":"ping"})),e.oPing=setTimeout(function(){!0===e.bPong?e._sendPing(e):(e.close(1e3,"Keep-Alive failed"),console.log("Connection closed due to failed Keep-Alive ..."))},3e4))};var _=function(e,o,t,n){var r=!0,s={};function c(e){s&&s.log&&s.log(e)}function i(e){var o=_.mRootSocket[e._sRootSocket];e.readyState&&e.readyState===SapPcpWebSocket.OPEN||(_.mFeedlet[e._sConnId]=e,o.readyState===SapPcpWebSocket.OPEN&&o.send("",{"pcp-mux-command":"open","pcp-mux-url":e._sUrl,"pcp-mux-vconnid":e._sConnId}),e.readyState=SapPcpWebSocket.CONNECTING)}function p(o){o._oReconnector=new m(o._sUrl,o._aProtocol),o._oReconnector.onopen=function(e){r&&c("Connection opened - Url: "+e.currentTarget.url+", Protocol: "+e.currentTarget.protocol+", ReadyState: "+e.currentTarget.readyState),o.readyState=o._oReconnector.readyState,o.onopen&&"function"==typeof o.onopen&&o.onopen(e)},o._oReconnector.onmessage=function(e){o.readyState=o._oReconnector.readyState,o.onmessage&&"function"==typeof o.onmessage&&o.onmessage(e)},o._oReconnector.onerror=function(e){o.readyState=o._oReconnector.readyState,o.onerror&&"function"==typeof o.onerror&&o.onerror(e)},o._oReconnector.onclose=function(e){r&&c("Connection closed - Url: "+e.currentTarget.url+", Protocol: "+e.currentTarget.protocol+", ReadyState: "+e.currentTarget.readyState),o.readyState=o._oReconnector.readyState,o.onclose&&"function"==typeof o.onclose&&o.onclose(e)}}function a(e){delete e["pcp-mux-command"],delete e["pcp-mux-url"],delete e["pcp-mux-vconnid"],delete e["pcp-mux-reason"],delete e["pcp-mux-application"]}function l(e){var o,t=0;for(var n in _.mFeedlet)n&&(o=_.mFeedlet[n])&&(e!==o._sRootSocket||o._oReconnector||o.readyState!==SapPcpWebSocket.OPEN||(t+=1));return 0<t}if(r&&(s=y.console),y.WebSocket)if(y.location.hostname)if(e){var d;d=new g(n||e);var u=new g;if(u.protocol("https"===u.protocol()?"wss":"ws"),!d.protocol()||d.protocol()===u.protocol()){if(d.host()||d.host(u.host()),!_.mRootSocket){_.mRootSocket={}}if(!_.mFeedlet){_.mFeedlet={}}var f,h,S;if(_.mRootSocket[d.host()]&&_.mRootSocket[d.host()].readyState!==SapPcpWebSocket.CLOSED)f=_.mRootSocket[d.host()];else h=n||u.protocol()+"://"+d.host()+"/sap/bc/apc/sap/-mux","string"==typeof o&&o!==SapPcpWebSocket.SUPPORTED_PROTOCOLS.v11?(o=[o]).push(SapPcpWebSocket.SUPPORTED_PROTOCOLS.v11):"[object Array]"===Object.prototype.toString.call(o)&&o.indexOf(-1===SapPcpWebSocket.SUPPORTED_PROTOCOLS.v11)&&o.push(SapPcpWebSocket.SUPPORTED_PROTOCOLS.v11),(f=new m(h,o)).sHost=d.host(),_.mRootSocket[d.host()]=f;return this._sUrl=e,this._aProtocol=o,this._sConnId=(S=(new Date).getTime(),"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=(S+16*function(){var e=y.crypto||y.msCrypto;if(e){var o=new Uint8Array(1);return 10/e.getRandomValues(o)[0]}return Math.random()}())%16|0;return S=Math.floor(S/16),("x"==e?o:3&o|8).toString(16)}).toUpperCase()),this._sRootSocket=d.host(),this._sMux=t,i(this),f.onopen=function(e){var o;for(var t in r&&c("Connection opened - Url: "+e.currentTarget.url+", Protocol: "+e.currentTarget.protocol+", ReadyState: "+e.currentTarget.readyState),_.mFeedlet)t&&(o=_.mFeedlet[t])&&i(o)}.bind(this),f.onclose=function(e){var o;for(var t in r&&c("Connection closed - Url: "+e.currentTarget.url+", Protocol: "+e.currentTarget.protocol+", ReadyState: "+e.currentTarget.readyState),_.mRootSocket[f.sHost]=void 0,_.mFeedlet)t&&(o=_.mFeedlet[t])&&(f.sHost!==o._sRootSocket||o._oReconnector||o._sMux!==SapPcpWebSocket.MUX.ON?o._oReconnector||f.sHost!==o._sRootSocket||o._sMux!==SapPcpWebSocket.MUX.AUTO||p(o):(_.mFeedlet[o._sConnId]=void 0,o.readyState=f.readyState,o.onclose&&"function"==typeof o.onclose&&o.onclose(e)))}.bind(this),f.onmessage=function(e){if(e.pcpFields&&e.pcpFields["pcp-mux-vconnid"]&&_.mFeedlet[e.pcpFields["pcp-mux-vconnid"]]){var o=_.mFeedlet[e.pcpFields["pcp-mux-vconnid"]];switch(e.pcpFields["pcp-mux-command"]){case"error":o.readyState=SapPcpWebSocket.CLOSED,r&&c("Error for Feedlet: "+JSON.stringify(e.pcpFields)),o.onerror&&"function"==typeof o.onerror&&(a(e.pcpFields),o.onerror(e)),!1===l(o._sRootSocket)?f.close(1e3,"Error for Feedlet: "+JSON.stringify(e.pcpFields)):o.onclose&&"function"==typeof o.onclose&&(a(e.pcpFields),o.onclose(e));break;case"mux-error":r&&c("Mux-Error for Feedlet: "+JSON.stringify(e.pcpFields)),o._sMux===SapPcpWebSocket.MUX.AUTO?!0===l(o._sRootSocket)?p(o):f.close(1e3,"Mux-Error for Feedlet "+JSON.stringify(e.pcpFields)):(o.readyState=SapPcpWebSocket.CLOSED,o.onerror&&"function"==typeof o.onerror&&(a(e.pcpFields),o.onerror(e)),!1===l(o._sRootSocket)?f.close(1e3,"Mux-Error for Feedlet "+JSON.stringify(e.pcpFields)):o.onclose&&"function"==typeof o.onclose&&(a(e.pcpFields),o.onclose(e)));break;case"accept":o.readyState!==SapPcpWebSocket.OPEN&&(o.readyState=SapPcpWebSocket.OPEN,o._sApplication=e.pcpFields["pcp-mux-application"],o.onopen&&"function"==typeof o.onopen&&(a(e.pcpFields),o.onopen(e)));break;case"reject":o.readyState=SapPcpWebSocket.CLOSED,r&&c("Rejected Feedlet: "+JSON.stringify(e.pcpFields)),o.onerror&&"function"==typeof o.onerror&&(a(e.pcpFields),o.onerror(e)),!1===l(o._sRootSocket)?f.close(1e3,"Rejected Feedlet: "+JSON.stringify(e.pcpFields)):o.onclose&&"function"==typeof o.onclose&&(a(e.pcpFields),o.onclose(e));break;case"disable":r&&c("Disabled Feedlet: "+JSON.stringify(e.pcpFields)),!0===l(o._sRootSocket)?p(o):(o._sMux=SapPcpWebSocket.MUX.AUTO,f.close(1e3,"Disabled Feedlet: "+JSON.stringify(e.pcpFields)));break;case"unsupported":r&&c("Unsupported Feedlet: "+JSON.stringify(e.pcpFields)),o._sMux===SapPcpWebSocket.MUX.AUTO?!0===l(o._sRootSocket)?p(o):f.close(1e3,"Unsupported Feedlet: "+JSON.stringify(e.pcpFields)):(o.readyState=SapPcpWebSocket.CLOSED,o.onerror&&"function"==typeof o.onerror&&(a(e.pcpFields),o.onerror(e)),!1===l(o._sRootSocket)?f.close(1e3,"Unsupported Feedlet: "+JSON.stringify(e.pcpFields)):o.onclose&&"function"==typeof o.onclose&&(a(e.pcpFields),o.onclose(e)));break;default:o.onmessage&&"function"==typeof o.onmessage&&(a(e.pcpFields),o.onmessage(e))}}else r&&c("Unknown Feedlet: "+JSON.stringify(e.pcpFields))}.bind(this),f.onerror=function(e){var o;for(var t in _.mFeedlet)t&&(o=_.mFeedlet[t])&&f.sHost===o._sRootSocket&&(o.readyState=f.readyState,o.readyState!==SapPcpWebSocket.OPEN&&o._sMux===SapPcpWebSocket.MUX.AUTO?!o._oReconnector&&r&&c("Connection to "+o._sUrl+" (Connection ID: "+o._sConnId+") will be closed. Trying to reconnect..."):o.onerror&&"function"==typeof o.onerror&&o.onerror(e))}.bind(this),this.send=function(e,o){this.readyState===SapPcpWebSocket.OPEN?this._oReconnector?this._oReconnector.send(e,o):(o["pcp-mux-command"]="send",o["pcp-mux-application"]=this._sApplication,o["pcp-mux-vconnid"]=this._sConnId,_.mRootSocket[this._sRootSocket].send(e,o)):r&&s.log("Connection to "+this._sUrl+" (Connection ID: "+this._sConnId+") has not readyState open (value 1), readyState is: "+this.readyState)},this.close=function(e,o){if(e&&o&&(1e3!==e||e<3e3&&4999<e))throw"DOMException.INVALID_ACCESS_ERR";var t=_.mRootSocket[this._sRootSocket];this.readyState===SapPcpWebSocket.OPEN&&(e&&o?this._oReconnector?this._oReconnector.close(e,o):t.send("",{"pcp-mux-command":"close","pcp-mux-application":this._sApplication,"pcp-mux-vconnid":this._sConnId,"pcp-mux-code":e.toString(),"pcp-mux-reason":o}):this._oReconnector?this._oReconnector.close():t.send("",{"pcp-mux-command":"close","pcp-mux-application":this._sApplication,"pcp-mux-vconnid":this._sConnId})),_.mFeedlet[this._sConnId]=void 0,t&&(l(t.sHost)||(t.close(e,o),_.mRootSocket[this._sRootSocket]=void 0)),this._oReconnector||(this.readyState=SapPcpWebSocket.CLOSED,this.onclose&&"function"==typeof this.onclose&&this.onclose())},this}r&&c("Protocol ( "+d.protocol()+" ) is not supported. Leaving...")}else r&&c("No application to connect to WebSocket. Leaving...");else r&&c("No URL to connect to WebSocket. Leaving...");else r&&c("Browser does not support WebSockets. Leaving...")},SapPcpWebSocket=function(e,o,t,n){if(o&&"string"!=typeof o&&"[object Array]"!==Object.prototype.toString.call(o))throw"Invalid type of parameter aProtocol";if(t&&"string"!=typeof t)throw"Invalid type of parameter sMux";if(t&&!(t in SapPcpWebSocket.MUX))throw"Invalid value of parameter sMux";if(n&&"string"!=typeof n)throw"Invalid type of parameter sMuxUrl";var r;return(r=!t||t!==SapPcpWebSocket.MUX.ON&&t!==SapPcpWebSocket.MUX.AUTO?new m(e,o):new _(e,o,t,n)).onopen=function(e){this.readyState=r.readyState,this.onopen&&"function"==typeof this.onopen&&this.onopen(e)}.bind(this),r.onclose=function(e){this.readyState=r.readyState,this.onclose&&"function"==typeof this.onclose&&this.onclose(e)}.bind(this),r.onmessage=function(e){this.readyState=r.readyState,this.onmessage&&"function"==typeof this.onmessage&&this.onmessage(e)}.bind(this),r.onerror=function(e){this.readyState=r.readyState,this.onerror&&"function"==typeof this.onerror&&this.onerror(e)}.bind(this),this.send=function(e,o){var t={};for(var n in o)n&&0!==n.indexOf("pcp-")&&(t[n]=o[n]);r.send(e,t)},this.close=function(e,o){r.close(e,o)},this};Object.defineProperty(SapPcpWebSocket,"SUPPORTED_PROTOCOLS",{value:{v10:"v10.pcp.sap.com",v11:"v11.pcp.sap.com"}}),Object.defineProperty(SapPcpWebSocket,"MUX",{value:{ON:"ON",AUTO:"AUTO",OFF:"OFF"}}),y.WebSocket&&Object.defineProperties(SapPcpWebSocket,{OPEN:{enumerable:!0,value:y.WebSocket.OPEN},CLOSED:{enumerable:!0,value:y.WebSocket.CLOSED},CLOSING:{enumerable:!0,value:y.WebSocket.CLOSING},CONNECTING:{enumerable:!0,value:y.WebSocket.CONNECTING}}),SapPcpWebSocket.prototype.onopen=null,SapPcpWebSocket.prototype.onclose=null,SapPcpWebSocket.prototype.onmessage=null,SapPcpWebSocket.prototype.onerror=null,y.SapPcpWebSocket=SapPcpWebSocket}(window);
